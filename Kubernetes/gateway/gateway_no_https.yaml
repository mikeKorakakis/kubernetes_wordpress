apiVersion: networking.istio.io/v1alpha3
kind: Gateway
metadata:
  name: motobook-gateway
  namespace: motobook
spec:
  selector:
    istio: ingressgateway # use istio default controller
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "*"
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: motobook
  namespace: motobook
spec:
  hosts:
  - "*"
  gateways:
  - motobook-gateway
  http: 
     - match:      
       - authority:
          exact: "identity.moto-book.com"
       route:
       - destination:
           host: identity
           port:
             number: 80
     - match:      
       - authority:
          exact: "www.moto-book.com"
       route:
       - destination:
           host: client
           port:
             number: 3000
     - match:      
       - authority:
          exact: "api.moto-book.com"
       route:
       - destination:
           host: api
           port:
             number: 80
     - match:      
       - authority:
          exact: "kiali.moto-book.com"
       route:
       - destination:
           host: kiali.istio-system.svc.cluster.local
           port:
             number: 20001
     - match:      
       - authority:
          exact: "grafana.moto-book.com"
       route:
       - destination:
           host: grafana.istio-system.svc.cluster.local
           port:
             number: 3000
     - match:      
       - authority:
          exact: "pgadmin.moto-book.com"
       route:
       - destination:
           host: pgadmin.motobook.svc.cluster.local
           port:
             number: 8080
    #  - route:
    #    - destination:
    #        host: client
    #        port:
    #         number: 3000
      